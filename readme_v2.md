# VFIX

## Project Overview
The widespread use of smart contracts across various industries has made them an attractive target for cyberattacks, leading to substantial financial losses. As a result, continuously patching newly discovered vulnerabilities in smart contracts has become an essential maintenance task. However, addressing these vulnerabilities requires specific security expertise, which many developers lack, making the task labor-intensive without effective tool support.

To meet this critical need, we present **VFIX**, a tool that automatically generates security patches for vulnerable smart contracts. VFIX combines template-based repairs with static program analysis techniques tailored to smart contracts. Our evaluations on 144 real-world smart contracts containing different types of vulnerabilities demonstrate that VFIX can successfully patch 94% of the vulnerabilities while preserving the expected functionality of the contracts.

## Installation Guide

### 1. Install Required Static Analysis Tools
- **Securify**: [GitHub Repository](https://github.com/eth-sri/securify)
- **Slither**: [GitHub Repository](https://github.com/crytic/slither)
- **Smartcheck**: [GitHub Repository](https://github.com/smartdec/smartcheck)

### 2. Install Truffle and Ganache
To test the patched contracts, youâ€™ll need to install Truffle and Ganache as follows:

- **Truffle**: A development, deployment, and testing framework for smart contracts.
  ```bash
  npm install -g truffle
  ```

- **Ganache**: A local Ethereum blockchain for testing contracts. You can download the [Ganache desktop version](https://trufflesuite.com/ganache/) or install the CLI:
  ```bash
  npm install -g ganache-cli
  ```

### 3. Install Other Dependencies
Install any remaining dependencies listed in `package-lock.json` by running:
```bash
npm install
```

## Usage Instructions

### Input
- A smart contract file with vulnerabilities
- Reports generated by static analysis tools

### Output
- The patched smart contract file

### Running the Tool
1. Use Securify, Slither, and Smartcheck to analyze the smart contract and generate vulnerability reports.
2. Feed the combined reports into VFIX to produce the patched smart contract.

### Example Command for Running the Python Script
After converting the original JavaScript code to Python classes, you can run VFIX using the following command:
```bash
python main.py --static_reports_path <path_to_static_reports> --contract_path <path_to_contract> --output_path <path_to_output>
```

### Code Example
Below is an example of using VFIX to automatically fix vulnerabilities:

```python
from Generator import Generator

# Specify the paths to the vulnerable contract and static analysis report
contract_path = 'data/vulnerable_contract.sol'
report_path = 'static_reports/data_report.json'

# Initialize the generator and apply fixes
generator = Generator(contract_path, report_path)
patched_contract = generator.apply_fix()

# Write the patched contract to a file
output_path = 'res/fixed_contract.sol'
with open(output_path, 'w') as f:
    f.write(patched_contract)
```

The generated `.sol` file contains the patched contract code. For example, for a reentrancy vulnerability, the patched code will update state variables before external calls to prevent reentrancy attacks.

## Examples and Results

In the `examples` folder, we provide sample contracts with vulnerabilities that can be used as inputs for VFIX. The `res` folder contains patched versions of these contracts.
